@page
@model DiceApi.Pages.BrowseModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<h2>Browse room list</h2>


<div class="row">
    <div class="col-12">
        <ul class="list-group list-group-flush" id="room-list"></ul>
    </div>
</div>


@section Scripts  {
<script type="text/javascript">
    $(function () {
        $('#room-list').empty();
        var getUsers = function () {
            $.ajax({
                type: 'get',
                url: '/api/rooms'
            }).done(function (e) {
                $.each(e, function (i, room) {
                    var item =
                        `<li class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="entry">
                                <strong>${room.id}. ${room.title} </strong>
                                <span class="badge badge-primary badge-pill">${room.onlineClientAmount}/${room.clientAmount}
                                    <span class="fa fa-user"></span>
                                </span>
                                </br>
                                <small>  Owner: ${room.owner.username}</small>
                            </span>
                            <span>
                                <input type="button" class="btn btn-primary btn-sm" value="Join" `;
                    if (Cookies.get('token') == null) {
                        item += `data-toggle="modal" data-target="#loginModal" data-redirect="/room/${room.id}"`;
                    } else {
                        item += `onclick="location.href='/room/${room.id}';"`;
                    }

                    item += ` />
                            </span>
                        </li>`;
                    $('#room-list').append(item);
                });
            });
        }
        getUsers();
    })
</script>
}
